/*! pinny 1.1.2 (https://github.com/mobify/pinny.git) */
(function(n){if("function"==typeof define&&define.amd)define(["$","plugin","bouncefix","velocity","lockup","shade"],n);else{var t=window.Zepto||window.jQuery;n(t,window.Plugin,window.bouncefix)}})(function(n,t,i,e){function s(n,t){s.__super__.call(this,n,t,s.DEFAULTS)}var o="Pinny requires a declared effect to operate. For more information read: https://github.com/mobify/pinny#initializing-the-plugin",a="a[href], area[href], input, select, textarea, button, iframe, object, embed, [tabindex], [contenteditable]",r="input, select, textarea";Function.prototype.bind||(Function.prototype.bind=function(n){var t=this;return function(){return t.apply(n)}});var c=n.os.ios&&7>=n.os.major,d={PINNY:"pinny",HEADER:"pinny__header",WRAPPER:"pinny__wrapper",SPACER:"pinny__spacer",TITLE:"pinny__title",CLOSE:"pinny__close",CONTENT:"pinny__content",OPENED:"pinny--is-open",SCROLLABLE:"pinny--is-scrollable"},h={COMPONENT:'<{0} class="'+d.PINNY+'__{0}">{1}</{0}>',HEADER:'<h1 class="'+d.TITLE+'">{0}</h1><button class="'+d.CLOSE+'">Close</button>',FOOTER:"{0}"},p={focus:"focus.pinny",blur:"blur.pinny"};return s.VERSION="1.1.2",s.DEFAULTS={effect:null,container:null,appendTo:null,structure:{header:"",footer:!1},zIndex:2,cssClass:"",coverage:"100%",easing:"swing",duration:200,shade:{},open:n.noop,opened:n.noop,close:n.noop,closed:n.noop,scrollDuration:50,spacerHeight:300},t.create("pinny",s,{_activeElement:function(){return n(document.activeElement)},animation:{beginClose:function(){},openComplete:function(){this._trigger("opened"),this._focus()},closeComplete:function(){this._trigger("closed"),this._resetFocus()}},_init:function(t){if(this.id="pinny-"+n.uniqueId(),this.$element=n(t),this.$doc=n(document),this.$body=n("body"),this._build(),!this.options.effect)throw o;this.effect=this.options.effect.call(this),this.$element.removeAttr("hidden"),this._bindEvents()},toggle:function(){this[this.$pinny.hasClass(d.OPENED)?"close":"open"]()},open:function(){this._isOpen()||(this._trigger("open"),i.add(d.SCROLLABLE),this.effect.open.call(this),this.options.shade&&this.$shade.shade("open"),this.$pinny.addClass(d.OPENED),this.$pinny.lockup("lock"))},close:function(){this._isOpen()&&(this._trigger("close"),i.remove(d.SCROLLABLE),this.$pinny.removeClass(d.OPENED),this.options.shade&&this.$shade.shade("close"),this.effect.close.call(this),this.$pinny.lockup("unlock"))},_isOpen:function(){return this.$pinny.hasClass(d.OPENED)},_bindEvents:function(){this.$pinny.on("touchmove",function(t){n(t.target).parents().hasClass(d.CONTENT)||t.preventDefault()})},_build:function(){var t=this;if(this.$pinny=n("<section />").addClass(d.PINNY).addClass(this.options.cssClass).css({position:"fixed",zIndex:this.options.zIndex,width:this.options.coverage,height:this.options.coverage}).on("click","."+d.CLOSE,function(n){n.preventDefault(),t.close()}).lockup({container:this.options.container,locked:function(){t._handleKeyboardShown()},unlocked:function(){t._handleKeyboardHidden()}}),this.$container=this.$pinny.data("lockup").$container,this.$pinny.appendTo(this.options.appendTo?n(this.options.appendTo):this.$container),this.options.structure){var i=n("<div />").addClass(d.WRAPPER).appendTo(this.$pinny);this._buildComponent("header").appendTo(i),n("<div />").addClass(d.CONTENT).addClass(d.SCROLLABLE).append(this.$element).append(this.$spacer).appendTo(i),this._buildComponent("footer").appendTo(i)}else this.$element.appendTo(this.$pinny);this.$header=this.$pinny.find("."+d.HEADER),this.$content=this.$pinny.find("."+d.CONTENT),this.$spacer=n("<div />").addClass(d.SPACER).height(this.options.spacerHeight).attr("hidden","hidden").appendTo(this.$content),this._addAccessibility(),this.options.shade&&(this.$shade=this.$pinny.shade(n.extend(!0,{},{click:function(){t.close()}},n.extend(this.options.shade,{duration:this.options.duration}))))},_buildComponent:function(t){var i=this.options.structure[t],e=n([]);if(i!==!1){var s=this._isHtml(i)?i:h[t.toUpperCase()].replace("{0}",i);e=n(h.COMPONENT.replace(/\{0\}/g,t).replace(/\{1\}/g,s))}return e},_isHtml:function(n){return/<[a-z][\s\S]*>/i.test(n)},_coverage:function(n){var t,i=this.options.coverage.match(/(\d*)%$/);return i&&(t=100-parseInt(i[1]),n&&(t/=n)),i?t+"%":this.options.coverage},_addAccessibility:function(){var n=this.id+"__header",t=this.$pinny.find("h1, ."+d.TITLE).first(),i=this.$pinny.find("."+d.WRAPPER);this.$container.attr("aria-hidden","false"),this.$pinny.attr("role","dialog").attr("aria-labelledby",n).attr("aria-hidden","true").attr("tabindex","-1"),i.attr("role","document"),t.attr("id",n)},_focus:function(){this.originalActiveElement=document.activeElement,this._disableInputs(),this.$pinny.attr("aria-hidden","false"),this.$pinny.children().first().focus(),this.$container.attr("aria-hidden","true")},_resetFocus:function(){this._enableInputs(),this.$container.attr("aria-hidden","false"),this.$pinny.attr("aria-hidden","true"),this.originalActiveElement.focus()},_disableInputs:function(){var t=n(a).not(function(){return n(this).closest(".pinny").length});t.each(function(t,i){var e=n(i),s=e.attr("tabindex")||0;e.data("tabindex",s).attr("tabindex","-1")})},_enableInputs:function(){var t=n("[data-pinny-tabindex]");t.each(function(t,i){var e=n(i),s=e.data("tabindex");s?e.attr("tabindex",s):e.removeAttr("tabindex"),e.removeData("tabindex")})},_handleKeyboardShown:function(){var n=this;c&&this.$pinny.find(r).on(p.focus,function(){n._inputFocus.call(n)}).on(p.blur,function(){n._inputBlur.call(n)})},_handleKeyboardHidden:function(){c&&this.$pinny.find(r).off(p.focus).off(p.blur)},_inputFocus:function(){var n=this;n.$spacer.removeAttr("hidden");for(var t=n._activeElement(),i=t.parent();"relative"===i.css("position")&&!i.hasClass(d.CONTENT);)t=i,i=t.parent();e.animate(t,"scroll",{container:n.$content[0],offset:-1*(n.$header.height()+parseInt(n.$content.css("padding-top"))),duration:this.options.scrollDuration})},_inputBlur:function(){var n=this;n._activeElement().is(r)&&n.$spacer.attr("hidden","")}}),n("[data-pinny]").each(function(){var t=n(this),i=n(this).data("pinny");if(!i.length)throw o;t.pinny({effect:i})}),n});