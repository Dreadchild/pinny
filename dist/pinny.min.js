/*! pinny 1.0.0 (https://github.com/mobify/pinny.git) */
(function(t){if("function"==typeof define&&define.amd)define(["$","bouncefix","plugin","velocity","shade"],t);else{var n=window.Zepto||window.jQuery;t(n,window.bouncefix,window.Plugin)}})(function(t,n,i,e){function s(t,n){s.__super__.call(this,t,n,s.DEFAULTS)}var o=t(document),a=t("html"),r=/chrome/i.test(navigator.userAgent),c=/android/i.test(navigator.userAgent),d=parseInt((/WebKit\/([0-9]+)/.exec(navigator.appVersion)||0)[1],10)||void 0,p=c&&537>d,h=p&&!r,l="Pinny requires a declared effect to operate. For more information read: https://github.com/mobify/pinny#initializing-the-plugin";Function.prototype.bind||(Function.prototype.bind=function(t){var n=this;return function(){return n.apply(t)}}),t.extend(t.fn,{renameAttr:function(n,i){return this.each(function(){var e=t(this);e.attr(i,e.attr(n)).removeAttr(n)})}});var u={PINNY:"pinny",CONTAINER:"pinny__container",WRAPPER:"pinny__wrapper",TITLE:"pinny__title",CLOSE:"pinny__close",CONTENT:"pinny__content",HEADER:"pinny__header",FOOTER:"pinny__footer",OPENED:"pinny--is-open",SCROLLABLE:"pinny--is-scrollable"},f={COMPONENT:'<{0} class="'+u.PINNY+'__{0}">{1}</{0}>',HEADER:'<h1 class="'+u.TITLE+'">{0}</h1><button class="'+u.CLOSE+'">Close</button>',FOOTER:"{0}"};return s.VERSION="1.0.0",s.DEFAULTS={effect:null,structure:{header:"",footer:!1},zIndex:2,cssClass:"",coverage:"100%",easing:"swing",duration:200,shade:{},open:t.noop,opened:t.noop,close:t.noop,closed:t.noop,container:null},i.create("pinny",s,{animation:{beginClose:function(){o.on("touchmove",this._blockScroll)},openComplete:function(){this._trigger("opened"),o.off("touchmove",this._blockScroll),this._focus()},closeComplete:function(){this._trigger("closed"),o.off("touchmove",this._blockScroll),this._resetFocus()}},_init:function(i){if(this.id="pinny-"+t.uniqueId(),this.iOSVersion=this._iOSVersion(),this.$element=t(i),this.$body=t("body"),this._build(),h&&this.$pinny.find("."+u.WRAPPER).addClass("no-flex-pinny"),n.add(u.CONTENT),!this.options.effect)throw l;this.effect=this.options.effect.call(this),this.$element.removeAttr("hidden"),this._bindEvents()},toggle:function(){this[this.$pinny.hasClass(u.OPENED)?"close":"open"]()},open:function(){this._trigger("open"),n.add(u.SCROLLABLE),this.effect.open.call(this),this.options.shade&&this.$shade.shade("open"),this.$pinny.addClass(u.OPENED),p&&this.$container.addClass("pinny--disable-taps"),this._enableScrollFix(),this._supportLegacyFlex()},close:function(){this._trigger("close"),n.remove(u.SCROLLABLE),this.$pinny.removeClass(u.OPENED),p&&this.$container.removeClass("pinny--disable-taps"),this.options.shade&&this.$shade.shade("close"),this.effect.close.call(this),this._disableScrollFix()},_bindEvents:function(){if(this.$pinny.on("touchmove",function(n){t(n.target).parents().hasClass(u.CONTENT)||n.preventDefault()}),h){var n=this;t(window).on("orientationchange resize",function(){n._supportLegacyFlex()})}},_build:function(){var n=this;if(this.$container=this._buildContainer(),this.$pinny=t("<section />").appendTo(this.$container).addClass(u.PINNY).addClass(this.options.cssClass).css({position:"fixed",zIndex:this.options.zIndex,width:this.options.coverage,height:this.options.coverage}).on("click","."+u.CLOSE,function(t){t.preventDefault(),n.close()}),this.options.structure){var i=t("<div />").addClass(u.WRAPPER).appendTo(this.$pinny);this._buildComponent("header").appendTo(i),t("<div />").addClass(u.CONTENT).addClass(u.SCROLLABLE).append(this.$element).appendTo(i),this._buildComponent("footer").appendTo(i)}else this.$element.appendTo(this.$pinny);this._addAccessibility(),this.options.shade&&(this.$shade=this.$pinny.shade(t.extend(!0,{},{click:function(){n.close()}},t.extend(this.options.shade,{duration:this.options.duration}))))},_buildComponent:function(n){var i=this.options.structure[n],e=t([]);if(i!==!1){var s=this._isHtml(i)?i:f[n.toUpperCase()].replace("{0}",i);e=t(f.COMPONENT.replace(/\{0\}/g,n).replace(/\{1\}/g,s))}return e},_buildContainer:function(){var n=t("."+u.CONTAINER);return this.options.container?n.length||(n=t(this.options.container).addClass(u.CONTAINER)):n.length||(n=this._createContainer()),n},_createContainer:function(){var n=this.$body.find("script").renameAttr("src","x-src").attr("type","text/pinny-script"),i=t("<div />").addClass(u.CONTAINER);return this.$body.wrapInner(i),n.renameAttr("x-src","src").attr("type","text/javascript"),i},_isHtml:function(t){return/<[a-z][\s\S]*>/i.test(t)},_blockScroll:function(t){t.preventDefault()},_coverage:function(t){var n,i=this.options.coverage.match(/(\d*)%$/);return i&&(n=100-parseInt(i[1]),t&&(n/=t)),i?n+"%":this.options.coverage},_enableScrollFix:function(){var n=this,i=function(t){return parseInt(n.$body.css(t))};if(this.scrollPosition=document.body.scrollTop,r)a.css("position","fixed"),a.css("top",-1*this.scrollPosition);else if(this.iOSVersion>=8){var s=i("padding-top")+i("padding-bottom");this.$body.css("margin-top",0).css("margin-bottom",0).height(window.innerHeight).css("overflow","hidden").scrollTop(this.scrollPosition-s)}else 7>=this.iOSVersion&&this.$pinny.find("input, select, textarea").on("focus",function(){setTimeout(function(){window.scrollTo(0,n.scrollPosition),n.$pinny.find(".pinny__input-space").length||n.$pinny.find(".pinny__content").append(t('<div class="pinny__input-space" style="height: 300px">')),e.animate(t(document.activeElement),"scroll",{container:n.$pinny.find("."+u.CONTENT)[0],offset:-1*n.$pinny.find("."+u.HEADER).height()-15,duration:50})},0)}).on("blur",function(){/(input|select|textarea)/i.test(document.activeElement.nodeName)||n.$pinny.find(".pinny__input-space").remove()})},_disableScrollFix:function(){r?(a.css("position",""),a.css("top",""),window.scrollTo(0,this.scrollPosition)):this.iOSVersion>=8?(this.$body.css("margin","").css("overflow","").css("height",""),window.scrollTo(0,this.scrollPosition)):7>=this.iOSVersion&&this.$pinny.find("input, select, textarea").off("focus")},_iOSVersion:function(){if(/ip(hone|od|ad)/i.test(navigator.platform)){var t=navigator.appVersion.match(/OS (\d+)_(\d+)_?(\d+)?/);return t=[parseInt(t[1],10),parseInt(t[2],10),parseInt(t[3]||0,10)],t&&t[0]||0}return 0},_addAccessibility:function(){var t=this.id+"__header",n=this.$pinny.find("h1, ."+u.TITLE).first(),i=this.$pinny.find("."+u.WRAPPER);this.$container.attr("aria-hidden","false"),this.$pinny.attr("role","dialog").attr("aria-labelledby",t).attr("aria-hidden","true").attr("tabindex","-1"),i.attr("role","document"),n.attr("id",t)},_focus:function(){this.originalActiveElement=document.activeElement,this._disableInputs(),this.$pinny.attr("aria-hidden","false"),this.$pinny.focus(),this.$container.attr("aria-hidden","true")},_resetFocus:function(){this._enableInputs(),this.$container.attr("aria-hidden","false"),this.$pinny.attr("aria-hidden","true"),this.originalActiveElement.focus()},_disableInputs:function(){var n="a[href], area[href], input, select, textarea, button, iframe, object, embed, [tabindex], [contenteditable]",i=t(n).not(function(){return t(this).closest(".pinny").length});i.each(function(n,i){var e=t(i),s=e.attr("tabindex")||0;e.data("tabindex",s).attr("tabindex","-1")})},_enableInputs:function(){var n=t("[data-pinny-tabindex]");n.each(function(n,i){var e=t(i),s=e.data("tabindex");s?e.attr("tabindex",s):e.removeAttr("tabindex"),e.removeData("tabindex")})},_supportLegacyFlex:function(){if(h){var t=this.$pinny.find("."+u.CONTENT),n=this.$pinny.find("."+u.HEADER),i=this.$pinny.find("."+u.FOOTER);setTimeout(function(){t.css("margin-top",n.height()+"px"),t.css("margin-bottom",i.height()+"px")},50)}}}),t("[data-pinny]").each(function(){var n=t(this),i=t(this).data("pinny");if(!i.length)throw l;n.pinny({effect:i})}),t});